digraph DuelingProtocol {
    bgcolor="#2E3440";
    node [shape=box, style="filled", fillcolor="#4C566A", fontname="sans-serif", fontcolor="#ECEFF4", color="#5E81AC"];
    edge [color="#88C0D0", fontname="sans-serif", fontcolor="#ECEFF4"];

    subgraph cluster_client {
        label = "Cliente";
        style = "filled";
        color = "#3B4252";
        fontcolor = "#ECEFF4";
        GameClient [label="GameClient\n(Interface do Usuário)"];
    }

    subgraph cluster_server {
        label = "Servidor Java";
        style = "filled";
        color = "#3B4252";
        fontcolor = "#ECEFF4";

        GameServer [label="GameServer\n(Ponto de Entrada TCP)"];
        PingServer [label="PingServer\n(Serviço UDP)"];

        subgraph cluster_handler {
            label = "Thread do Cliente";
            style = "dashed";
            color = "#5E81AC";
            ClientHandler [label="ClientHandler\n(Parser de Comandos)"];
        }

        subgraph cluster_facade {
            label = "Lógica de Negócio";
            style = "dashed";
            color = "#5E81AC";
            GameFacade [label="GameFacade\n(Orquestrador Central)"];
        }

        subgraph cluster_services {
            label = "Serviços";
            style = "dashed";
            color = "#5E81AC";
            MatchmakingService [label="ConcurrentMatchmakingService\n(Fila de Pareamento)"];
            StoreService [label="StoreServiceImpl\n(Lógica da Loja)"];
        }
        
        subgraph cluster_persistence {
            label = "Persistência";
            style = "dashed";
            color = "#5E81AC";
            PlayerRepository [label="PlayerRepositoryJson\n(Leitura/Escrita de JSON)"];
            CardRepository [label="CardRepository\n(Estoque de Cartas)"];
        }
    }
    
    subgraph cluster_storage {
        label = "Armazenamento";
        style = "filled";
        color = "#3B4252";
        fontcolor = "#ECEFF4";
        PlayerData [label="players.json", shape=document, fillcolor="#81A1C1"];
    }

    // Conexões
    GameClient -> GameServer [label="Comandos TCP"];
    GameClient -> PingServer [label="Pacotes UDP"];
    GameServer -> ClientHandler [label="Cria Thread"];
    ClientHandler -> GameFacade [label="Chama métodos"];
    GameFacade -> MatchmakingService;
    GameFacade -> StoreService;
    GameFacade -> PlayerRepository;
    StoreService -> CardRepository [label="Acessa estoque"];
    PlayerRepository -> PlayerData [label="Lê/Escreve"];
}